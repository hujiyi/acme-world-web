(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac56cc6c"],{"04d1":function(e,t,n){var r=n("342f"),a=r.match(/firefox\/(\d+)/i);e.exports=!!a&&+a[1]},"408a":function(e,t,n){var r=n("e330");e.exports=r(1..valueOf)},"4e82":function(e,t,n){"use strict";var r=n("23e7"),a=n("e330"),i=n("59ed"),s=n("7b0b"),o=n("07fa"),l=n("577e"),c=n("d039"),u=n("addb"),d=n("a640"),f=n("04d1"),p=n("d998"),m=n("2d00"),g=n("512ce"),h=[],v=a(h.sort),b=a(h.push),w=c((function(){h.sort(void 0)})),x=c((function(){h.sort(null)})),I=d("sort"),y=!c((function(){if(m)return m<70;if(!(f&&f>3)){if(p)return!0;if(g)return g<603;var e,t,n,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)h.push({k:t+r,v:n})}for(h.sort((function(e,t){return t.v-e.v})),r=0;r<h.length;r++)t=h[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}})),_=w||!x||!I||!y,k=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:l(t)>l(n)?1:-1}};r({target:"Array",proto:!0,forced:_},{sort:function(e){void 0!==e&&i(e);var t=s(this);if(y)return void 0===e?v(t):v(t,e);var n,r,a=[],l=o(t);for(r=0;r<l;r++)r in t&&b(a,t[r]);u(a,k(e)),n=a.length,r=0;while(r<n)t[r]=a[r++];while(r<l)delete t[r++];return t}})},"512ce":function(e,t,n){var r=n("342f"),a=r.match(/AppleWebKit\/(\d+)\./);e.exports=!!a&&+a[1]},7156:function(e,t,n){var r=n("1626"),a=n("861d"),i=n("d2bb");e.exports=function(e,t,n){var s,o;return i&&r(s=t.constructor)&&s!==n&&a(o=s.prototype)&&o!==n.prototype&&i(e,o),e}},7474:function(e,t,n){},"7cdb":function(e,t,n){"use strict";n("7474")},a640:function(e,t,n){"use strict";var r=n("d039");e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},a9e3:function(e,t,n){"use strict";var r=n("83ab"),a=n("da84"),i=n("e330"),s=n("94ca"),o=n("6eeb"),l=n("1a2d"),c=n("7156"),u=n("3a9b"),d=n("d9b5"),f=n("c04e"),p=n("d039"),m=n("241c").f,g=n("06cf").f,h=n("9bf2").f,v=n("408a"),b=n("58a8").trim,w="Number",x=a[w],I=x.prototype,y=a.TypeError,_=i("".slice),k=i("".charCodeAt),S=function(e){var t=f(e,"number");return"bigint"==typeof t?t:C(t)},C=function(e){var t,n,r,a,i,s,o,l,c=f(e,"number");if(d(c))throw y("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=b(c),t=k(c,0),43===t||45===t){if(n=k(c,2),88===n||120===n)return NaN}else if(48===t){switch(k(c,1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+c}for(i=_(c,2),s=i.length,o=0;o<s;o++)if(l=k(i,o),l<48||l>a)return NaN;return parseInt(i,r)}return+c};if(s(w,!x(" 0o1")||!x("0b1")||x("+0x1"))){for(var A,E=function(e){var t=arguments.length<1?0:x(S(e)),n=this;return u(I,n)&&p((function(){v(n)}))?c(Object(t),n,E):t},T=r?m(x):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),N=0;T.length>N;N++)l(x,A=T[N])&&!l(E,A)&&h(E,A,g(x,A));E.prototype=I,I.constructor=E,o(a,w,E)}},addb:function(e,t,n){var r=n("f36a"),a=Math.floor,i=function(e,t){var n=e.length,l=a(n/2);return n<8?s(e,t):o(e,i(r(e,0,l),t),i(r(e,l),t),t)},s=function(e,t){var n,r,a=e.length,i=1;while(i<a){r=i,n=e[i];while(r&&t(e[r-1],n)>0)e[r]=e[--r];r!==i++&&(e[r]=n)}return e},o=function(e,t,n,r){var a=t.length,i=n.length,s=0,o=0;while(s<a||o<i)e[s+o]=s<a&&o<i?r(t[s],n[o])<=0?t[s++]:n[o++]:s<a?t[s++]:n[o++];return e};e.exports=i},b3d7:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-card",{attrs:{shadow:"always"}},[n("div",{staticClass:"horiz-container align-center",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"header-text"},[e._v("论坛话题管理")]),n("el-divider",{staticClass:"header-text",attrs:{direction:"vertical"}}),n("el-button",{attrs:{type:"danger",disabled:e.selected.length<=0},on:{click:e.deleteSelected}},[e._v("批量删除")]),n("div",{staticClass:"spacer"}),n("el-button",{attrs:{size:"medium",type:"success"},on:{click:function(t){e.dialog=!0}}},[n("i",{staticClass:"fa fa-plus"}),e._v(" 添加新话题 ")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.topics,stripe:"",border:""},on:{"selection-change":e.mutilSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"35",align:"center"}}),n("el-table-column",{attrs:{prop:"title",label:"话题"}}),n("el-table-column",{attrs:{prop:"level",label:"排序值",width:"70"}}),n("el-table-column",{attrs:{label:"查看/评论",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.views))]),e._v(" / "),n("span",[e._v(e._s(t.row.reply))])]}}])}),n("el-table-column",{attrs:{label:"作者",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.createdBy.username))]),n("br"),n("span",[e._v(e._s(e._f("datetimeFormat")(t.row.createdAt)))])]}}])}),n("el-table-column",{attrs:{label:"最后修改",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.lastEditor.username))]),n("br"),n("span",[e._v(e._s(e._f("datetimeFormat")(t.row.updatedAt)))])]}}])}),n("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"medium",title:"编辑"},on:{click:function(n){return e.editItem(t.row)}}},[n("i",{staticClass:"fa fa-pencil-square-o fa-lg",staticStyle:{color:"blue"}})]),n("el-button",{attrs:{size:"medium",type:"text",title:"删除"},on:{click:function(n){return e.deleteItem(t.row)}}},[n("i",{staticClass:"fa fa-trash-o fa-lg",staticStyle:{color:"red"}})])]}}])})],1),n("div",{staticClass:"horiz-container"},[n("div",{staticClass:"spacer"}),n("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount,"page-sizes":[5,10,20,30],"page-size":e.pageSize,"current-page":e.currentPage},on:{"size-change":e.getTopics,"current-change":e.getTopics,"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),n("el-dialog",{attrs:{visible:e.dialog,width:"80%","close-on-click-modal":!1,fullscreen:e.fullscreen},on:{"update:visible":function(t){e.dialog=t}}},[n("span",{attrs:{slot:"title"},slot:"title"},[e.fullscreen?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!1}}},[n("i",{staticClass:"fa fa-clone",staticStyle:{"font-size":"20px"},attrs:{title:"还原"}})]):n("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!0}}},[n("i",{staticClass:"fa fa-square-o",staticStyle:{"font-size":"20px"},attrs:{title:"最大化"}})]),n("span",{staticClass:"dialog-title mx-2"},[e._v(e._s(e.formTitle))])],1),n("el-card",{attrs:{shadow:"always"}},[n("el-form",{attrs:{"label-position":"top"}},[n("el-row",{attrs:{gutter:20}},[-1!==e.editedIndex?n("el-col",{attrs:{md:24-e.formCols,sm:24}},[n("el-form-item",{attrs:{label:"手工排序值"}},[n("el-input",{attrs:{type:"number","controls-position":"right",max:1e3,label:"Level"},model:{value:e.editedItem.level,callback:function(t){e.$set(e.editedItem,"level",t)},expression:"editedItem.level"}})],1)],1):e._e(),n("el-col",{attrs:{md:e.formCols,sm:24}},[n("el-form-item",{attrs:{label:"标题"}},[n("el-input",{attrs:{placeholder:"标题",maxlength:"50","show-word-limit":""},model:{value:e.editedItem.title,callback:function(t){e.$set(e.editedItem,"title",t)},expression:"editedItem.title"}})],1)],1)],1),n("el-form-item",{attrs:{label:"话题内容(支持 Markdown 语法)"}},[n("el-input",{attrs:{type:"textarea",rows:e.row,placeholder:"话题内容"},model:{value:e.editedItem.content,callback:function(t){e.$set(e.editedItem,"content",t)},expression:"editedItem.content"}})],1)],1)],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialog=!1}}},[e._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.saveItem}},[e._v("保存")])],1)],1)],1)},a=[],i=n("1da1"),s=(n("96cf"),n("d81d"),n("498a"),n("4e82"),n("a9e3"),n("59a6")),o=n("c1df"),l=n.n(o),c={name:"TopicManager",data:function(){return{topics:[],dialog:!1,fullscreen:!1,loading:!1,pageSize:10,currentPage:1,totalCount:0,selected:[],editedIndex:-1,editedItem:{title:"",content:"",level:0,views:0,reply:0},defaultItem:{title:"",content:"",level:0,views:0,reply:0}}},mounted:function(){this.getTopics()},methods:{getTopics:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.topics=[],n=(e.currentPage-1)*e.pageSize,t.next=5,s["a"].fetchAll(e.pageSize,n,["createdBy","lastEditor"],["-level","-updatedAt"]);case 5:r=t.sent,"ok"===r.status_code&&(e.totalCount=r.totalCount,e.topics=r.reslut.map((function(t){return e.formJson(t)}))),e.loading=!1;case 8:case"end":return t.stop()}}),t)})))()},saveItem:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("this.editedIndex：",e.editedIndex),-1!==e.editedIndex){t.next=17;break}return t.next=4,s["a"].currentUser();case 4:return e.editedItem.createdBy=t.sent,t.next=7,s["a"].currentUser();case 7:if(e.editedItem.lastEditor=t.sent,e.editedItem.lastRepliedAt=new Date,e.editedItem.title=e.editedItem.title.trim(),!e.editedItem.title){t.next=15;break}return t.next=13,s["a"].create(e.editedItem);case 13:n=t.sent,n?(e.topics.unshift(e.formJson(n)),e.topics.sort((function(e,t){return t.level-e.level})),e.topics.length>e.pageSize&&e.topics.pop(),e.$message({message:"已经成功添加一个话题: ".concat(e.editedItem.title),type:"success"}),e.dialog=!1):e.$message({message:"标题不能为空",type:"warning"});case 15:t.next=31;break;case 17:return r=Object.assign(e.topics[e.editedIndex],e.editedItem),t.t0=s["a"],t.t1=r.id,t.t2=r.title,t.t3=r.content,t.t4=Number(r.level),t.next=25,s["a"].currentUser();case 25:return t.t5=t.sent,t.t6={title:t.t2,content:t.t3,level:t.t4,lastEditor:t.t5},t.next=29,t.t0.update.call(t.t0,t.t1,t.t6);case 29:a=t.sent,a?(e.topics[e.editedIndex].updatedAt=a.updatedAt,e.topics.sort((function(e,t){return t.level-e.level})),e.$message({message:"论坛话题编辑成功",type:"success"}),e.dialog=!1):e.$message({message:"出现错误, 无法完成论坛话题修改",type:"error"});case 31:case"end":return t.stop()}}),t)})))()},editItem:function(e){this.editedIndex=this.topics.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},deleteItem:function(e){var t=this;this.$confirm('确定要删除标题为："'.concat(e.title,'" 的话题吗？'),"删除话题",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s["a"].delete(e.id);case 2:r=n.sent,r&&(t.getTopics(),t.$message({type:"success",message:"删除成功!"}));case 4:case"end":return n.stop()}}),n)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},deleteSelected:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("确定要删除已选中的 ".concat(e.selected.length," 个话题吗？"),"批量删除话题",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s["a"].deleteBatch(e.selected);case 2:n=t.sent,n&&(e.getTopics(),e.$message({type:"success",message:"成功删除选中的 ".concat(e.selected.length," 个话题!")}),e.selected=[]);case 4:case"end":return t.stop()}}),t)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}));case 1:case"end":return t.stop()}}),t)})))()},mutilSelectionChange:function(e){this.selected=e,console.log("mutilSelectionChange:",this.selected)},getUser:function(e){return{id:e.id,username:e.get("username"),email:e.get("email")}},formJson:function(e){return{id:e.id,title:e.get("title"),content:e.get("content"),views:e.get("views"),reply:e.get("reply"),level:e.get("level"),lastRepliedAt:e.get("lastRepliedAt"),createdAt:e.createdAt,updatedAt:e.updatedAt,createdBy:e.get("createdBy")?this.getUser(e.get("createdBy")):"",lastEditor:e.get("lastEditor")?this.getUser(e.get("lastEditor")):""}},closeDialog:function(){var e=this;this.dialog=!1,this.fullscreen=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))}},computed:{formTitle:function(){return-1===this.editedIndex?"添加新话题":"话题编辑"},formCols:function(){return-1===this.editedIndex?24:21},row:function(){return this.fullscreen?15:5}},filters:{datetimeFormat:function(e){return l()(e).format("lll")}},watch:{dialog:function(e){e||this.closeDialog()}}},u=c,d=(n("7cdb"),n("2877")),f=Object(d["a"])(u,r,a,!1,null,null,null);t["default"]=f.exports},d998:function(e,t,n){var r=n("342f");e.exports=/MSIE|Trident/.test(r)}}]);
//# sourceMappingURL=chunk-ac56cc6c.a2ab9e93.js.map